<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Corrección de los ejercicios de selectores de JS</title>
  <script type="module" src="./src/main.js"></script>
<style>
    #game{
      display: grid;
      grid-template-columns: repeat(6, 1fr);
      grid-template-rows: repeat(5,1fr);
      gap: 10px;
    }
    .box{
      width: 100%;
      height: 100px;
      border: 1px solid black;
      background-color: black;
    }
  </style>
</head>
<body>
  <h1>Corrección de los ejercicios de eventos</h1>
  <h2>Ejercicio 8</h2>
  <p><a href="index.html">Atras</a></p>
  <p>Juguemos a adivinar las parejas. Debes distribuir en la página una cuadrícula de 6 x 5 cajas. 
    De las 30 cajas habrá 15 distintas. Cada par de cajas será de un color distinto. Inicialmente 
    todas las cajas aparecerán negras. Cuando el usuario pinche sobre una caja, se revelará su 
    auténtico color. En ese momento debes arrastrar la caja al lugar donde creas que se encuentra 
    su pareja. Si aciertas, ambas cajas permanecerán boca arriba y ya no se podrá interactuar con 
    ellas. Si fallas, las dos cajas volverán a su estado inicial. El programa debe detectar cuándo 
    están todas las cajas emparejadas y cuánto tiempo has tardado en resolverlo.
</p>
    <main>
      <h2><span id="timer">00:00:00</span></h2>
       <section id="game"></section>
    </main>
    <script>
        let cols = 6;
        let rows = 5;
        let game = document.getElementById('game');

        let randomColors = [];

        for (let index = 0; index < (rows*cols/2); index++){
          let red = Math.floor(Math.random()*256);
          let blue = Math.floor(Math.random()*256);
          let green = Math.floor(Math.random()*256);
          let color =`rgb(${red}, ${blue}, ${green})`;
          randomColors.push(color);
        }

        randomColors = [...randomColors, ...randomColors];

        function shuffle(array) {
          let currentIndex = array.length;

          // While there remain elements to shuffle...
          while (currentIndex != 0) {

            // Pick a remaining element...
            let randomIndex = Math.floor(Math.random() * currentIndex);
            currentIndex--;

            // And swap it with the current element.
            [array[currentIndex], array[randomIndex]] = [
              array[randomIndex], array[currentIndex]];
          }
        }

        shuffle(randomColors);

        for (let row = 0; row<rows; row++){
          for (let col = 0; col<cols; col++){
            let box = document.createElement('div');
            box.classList.add('box');
            box.dataset.col = col + 1;
            box.dataset.row = row + 1;
            box.dataset.color = randomColors.shift();
            box.dataset.open = 0;
            box.dataset.solve = 0;
            game.appendChild(box);
            


            let comprobarColor = (event)=>{
              event.target.style.backgroundColor = event.target.dataset.color;
              event.target.dataset.open = 1;

              let boxesOpen = document.querySelectorAll('[data-open="1"]');

              if(boxesOpen.length ==2){
                if(boxesOpen[0].dataset.color == boxesOpen[1].dataset.color){
                  boxesOpen[0].removeEventListener('click',comprobarColor);
                  boxesOpen[1].removeEventListener('click',comprobarColor)
                  boxesOpen[0].dataset.open = 0;
                  boxesOpen[1].dataset.open = 0;        
                  boxesOpen[0].dataset.solve = 1;  
                  boxesOpen[1].dataset.solve = 1;       
                  let boxesSolved = document.querySelectorAll('[data-solve="1"]'); 
                  if (boxesSolved.length == cols*rows){
                    alert('Hemos terminado el juego');
                    stopwatch.stop();
                  }   
                }
                else{
                  setTimeout(()=>{
                  boxesOpen[0].style.backgroundColor = 'black';
                  boxesOpen[1].style.backgroundColor = 'black';
                  boxesOpen[0].dataset.open = 0;
                  boxesOpen[1].dataset.open = 0;
                },500);

                }
              }
            }

            box.addEventListener('click',comprobarColor);
          }
        }



    var min,sec,ms,count, malt, salt, msalt;

    var stopwatch = {
      start: function(){
        ms = 0;
        sec = 0;
        min = 0;
        count = setInterval(function(){
          if(ms == 100){
            ms = 0;
            if(sec == 60){
              sec = 0;
              min++;
            }
            else{
              sec++;
            }
          }
          else{
            ms++;
          }
          
          malt = stopwatch.pad(min);
          salt = stopwatch.pad(sec);
          msalt = stopwatch.pad(ms);
          
          stopwatch.update(malt + ":" + salt + ":" + msalt);
        }, 10);
        },
      stop: function(){
        clearInterval(count);
      },
      
      update: function(txt){
        var temp = document.getElementById("timer");
      temp.firstChild.nodeValue = txt;
      },
      
      pad: function(time){
        var temp;
        if(time < 10){
          temp = "0" + time;
        }
        else{
          temp = time;
        }
        return temp;
      }
    }

    stopwatch.start();
    </script>
</body>
</html>